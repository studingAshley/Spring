<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.java.www.mapper.BoardMapper">

	<select id="bList" resultType="com.java.www.dto.BoardDto">

		select * from (	select rownum rnum, a.* from ( select * from (select * from board  where 
		<if test="category == 'all' or category==''">
			 btitle LIKE '%'||#{searchWord}||'%' or bcont LIKE '%'||#{searchWord}||'%'
		</if>
		<if test="category == 'btitle' or category == 'bcont'">
			 ${category} like '%'||#{searchWord}||'%'

		</if>
		 order by bgroup desc, bstep asc))a )where rnum  between #{startRow} and #{endRow}	

	</select>
	
	
	
	<select id="bView" resultType="com.java.www.dto.BoardDto">
	<![CDATA[
		select * from board where bno=#{bno}
	]]>
	</select>
	
	<select id="bPreView" resultType="com.java.www.dto.BoardDto">
	<![CDATA[
		select * from ( select rownum rnum, a.* from (select * from board order by bgroup desc, bstep asc)a) where rnum = (select rnum from ( select rownum rnum, a.* from (select * from board order by bgroup desc, bstep asc)a) where bno =#{bno})-1
	]]>
	</select>
	
	<select id="bNextView" resultType="com.java.www.dto.BoardDto">
	<![CDATA[
		select * from ( select rownum rnum, a.* from (select * from board order by bgroup desc, bstep asc)a) where rnum = (select rnum from ( select rownum rnum, a.* from (select * from board order by bgroup desc, bstep asc)a) where bno =#{bno})+1
	]]>
	</select>
	
	<select id="bReply" resultType="com.java.www.dto.BoardReplyDto">
		select * from bocomment
	</select>
	
	

	<select id="countAllList" resultType="int">
		select count(*) countall from board where
		<if test="category == 'all' or category==''">
			 btitle LIKE '%'||#{searchWord}||'%' or bcont LIKE '%'||#{searchWord}||'%'
		</if>
		<if test="category == 'btitle' or category == 'bcont'">
			 ${category} like '%'||#{searchWord}||'%'

		</if>

		 
		 
	</select>
		
	<insert id="bWrite">
		insert into board values(board_seq.nextval,#{btitle},#{bcont},sysdate,#{id},board_seq.currval,0,0,1,#{bfile})
	</insert>
	
	<delete id="bDelete">
		delete from board where bno=#{bno}
	</delete>

	<update id="doBUpdate">
		update board set btitle=#{btitle},bcont=#{bcont}, bdate = sysdate, bfile=#{bfile}  where bno=#{bno}
	</update>
	
	<update id="stepCounter">
		update board set bstep=bstep+1 where bgroup=#{bgroup} and bstep>#{bstep}
	</update>
	
	<insert id="doBReply">
		insert into board values(board_seq.nextval,#{btitle},#{bcont},sysdate,#{id},#{bgroup},#{bstep}+1,#{bindent}+1,1,#{bfile})
	</insert>
	<update id="hitCounter">
		update board set bhit = bhit+1 where bno=#{bno}
	</update>
	

</mapper>